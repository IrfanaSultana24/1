<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üéâ A Little Goodbye</title>
  <style>
    :root{
      --bg1:#0f172a; --bg2:#1e293b;
      --card:#0b1220cc; /* adjust transparency via last two hex digits */
      --text:#e2e8f0; --border:#1f2a44;
      --accent:#30c48d;
    }
    html,body{height:100%;margin:0}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
      color:var(--text);
      display:grid; place-items:center;
      background: radial-gradient(1200px 800px at 10% 10%, var(--bg2), var(--bg1));
      background-size: cover; background-position: center; background-attachment: fixed;
      overflow-x:hidden;
    }

    .card{
      position:relative; z-index:2; max-width:720px; width:min(92vw,720px);
      backdrop-filter: blur(12px);
      background: var(--card);
      border:1px solid var(--border); border-radius:20px;
      padding:28px 28px 22px;
      box-shadow:0 20px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
    }
    h1{ font-size: clamp(28px,5vw,44px); margin:8px 0 10px; line-height:1.1; }
    .msg{ font-size: clamp(16px,2.6vw,20px); opacity:.92; margin:0 0 14px; }
    .meta{ opacity:.8; font-size:14px; margin-top:6px; }
    .row{ display:flex; flex-wrap:wrap; gap:10px; margin-top:18px; }
    button{
      appearance:none; border:1px solid #334155; background:#0b1220; color:var(--text);
      padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
      transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease;
    }
    button:hover{ border-color:#475569; box-shadow:0 8px 20px rgba(0,0,0,.25); transform:translateY(-1px); }

    /* HUD (game) */
    .hud{
      position:fixed; right:14px; top:14px; z-index:5; display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      background:#0b1220cc; border:1px solid var(--border); border-radius:12px; padding:8px 10px; backdrop-filter: blur(8px);
      font-size:12px;
    }
    .hud .pill{ padding:4px 8px; border:1px solid #2b3b52; border-radius:10px; background:#0e1728; }
    .hud .best{ border-color:#2e5a4c; }
    .hud .play{ border-color:#355281; }

    /* Toast */
    .toast{
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%); z-index:6;
      background:#0b1220cc; border:1px solid var(--border); border-radius:12px; padding:10px 14px;
      box-shadow:0 12px 30px rgba(0,0,0,.35); backdrop-filter: blur(8px); font-weight:600;
      opacity:0; pointer-events:none; transition:opacity .25s ease, transform .25s ease;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px) }

    /* Emoji rain */
    .emoji { position:fixed; top:-60px; z-index:1; pointer-events:auto; user-select:none; }
    .emoji .inner{
      display:block; filter: drop-shadow(0 3px 6px rgba(0,0,0,.35));
      animation: sway 7.5s ease-in-out infinite;
      transition: transform .12s ease, opacity .2s ease;
      cursor:pointer;
    }
    .emoji .inner:hover{ transform: scale(1.12) }
    .emoji.pop .inner{ animation:none }

    @keyframes fall { to { transform: translateY(110vh); opacity:1; } }
    @keyframes sway { 0%{ transform: translateX(0) rotate(0deg); }
                      50%{ transform: translateX(var(--sx, 22px)) rotate(var(--rot, 10deg)); }
                      100%{ transform: translateX(0) rotate(0deg); } }
    @keyframes popAway { 0%{ transform: translateY(0) scale(1); opacity:1 }
                         60%{ transform: translateY(-18px) scale(1.35); opacity:.95 }
                         100%{ transform: translateY(-46px) scale(.6); opacity:0 } }
    .sparkle{
      position:fixed; z-index:3; pointer-events:none; color:#ffe08a; font-size:18px;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); animation: sparkleUp .8s ease-out forwards;
    }
    @keyframes sparkleUp{ 0%{ transform: translateY(0) scale(.9); opacity:.95 }
                          100%{ transform: translateY(-28px) scale(1.1); opacity:0 } }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .emoji .inner{ animation:none }
    }
  </style>
</head>
<body>
  <!-- HUD -->
  <div class="hud" id="hud">
    <span class="pill">Score: <b id="score">0</b></span>
    <span class="pill">Streak: <b id="streak">0</b></span>
    <span class="pill">Misses: <b id="misses">0</b></span>
    <span class="pill">Time: <b id="time">‚Äî</b></span>
    <span class="pill best">Best: <b id="best">0</b></span>
    <button class="pill play" id="playBtn">‚ñ∂Ô∏è Play 30s</button>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Card -->
  <div class="card">
    <h1 id="title">Thank you, team!</h1>
    <p class="msg" id="message">Hello everyone,
      I‚Äôm writing to share that I‚Äôll be leaving Laing O‚ÄôRourke to begin the next chapter of my career. Working at HPC has been a privilege ‚Äî I‚Äôve learned so much from each of you, and those lessons and experiences will stay with me. My last working day is Thursday, 4 September 2025.
      If our paths cross in the future, I‚Äôd be delighted to work with you again. If you‚Äôd like to stay in touch, please use the ‚ÄúGet in touch‚Äù button </p>
    <p class="meta" id="signature">‚Äî Irfana</p>
    <div class="row">
      <button id="replay">ü§ù Replay animation</button>
      <button id="feedbackBtn">üí¨ Leave feedback</button>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <h2>üí¨ Share your feedback</h2>
      <textarea id="fbText" placeholder="Write a quick note..."></textarea>
      <div class="modal-actions">
        <button id="cancel">Cancel</button>
        <button id="send">Send</button>
      </div>
    </div>
  </div>

  <!-- Hidden iframe target for Google Form submission -->
  <iframe name="gform-target" style="display:none"></iframe>

<script>
  const qs = new URLSearchParams(location.search);

  // Content
  const title = qs.get('title') || "Thank you, team!";
  const msg   = qs.get('msg')   || "It‚Äôs been a privilege to build, iterate, and ship with you. Wishing you smooth workflows and zero clashes ahead!";
  const name  = qs.get('name')  || "Irfana";
  const bg    = qs.get('bg')    || "1.jpeg";

  document.getElementById('title').textContent = title;
  document.getElementById('message').textContent = msg;
  document.getElementById('signature').textContent = `‚Äî ${name}`;
  if (bg) {
    const url = bg.match(/^https?:\/\//) ? bg : `${bg}`;
    document.body.style.backgroundImage = `url('${url}')`;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
  }

  /* =================== RAIN + GAME =================== */
  const EMOJIS = ["üëã","üíê", "ü§ù","üë©‚Äçüíª","üôè","‚ö°","‚ò¢Ô∏è","üèóÔ∏è","üíå"];
  // Normal mode (slightly faster than before)
  let CUR_MAX_ACTIVE = 18;
  let CUR_SPAWN_MS   = 950;        // faster spawn
  let CUR_DUR_RANGE  = [12, 20];   // faster fall

  // Game mode presets (speed-up)
  const GAME_MAX_ACTIVE = 24;
  const GAME_SPAWN_MS   = 520;
  const GAME_DUR_RANGE  = [8, 14];
  const GAME_TIME       = 30; // seconds

  // Lane-based even spread with jitter
  let laneIndex = 0, spawner = null;
  function lanes(){
    const n = Math.max(10, Math.floor(window.innerWidth / 120));
    const pad = 1.5;
    const step = (100 - pad*2) / (n - 1);
    return { n, pad, step };
  }

  function activeCount(){ return document.querySelectorAll('.emoji').length; }

  function sparkle(x,y,txt="‚ú®"){
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.textContent = txt;
    s.style.left = x + "px";
    s.style.top  = y + "px";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(), 900);
  }

  // Game state
  let gameActive = false, score=0, streak=0, misses=0, timeLeft=0, gameTimer=null, diffTimer=null;
  const scoreEl = document.getElementById('score');
  const streakEl= document.getElementById('streak');
  const missEl  = document.getElementById('misses');
  const timeEl  = document.getElementById('time');
  const bestEl  = document.getElementById('best');
  const playBtn = document.getElementById('playBtn');
  let best = Number(localStorage.getItem('gb_best')||0); bestEl.textContent = best;

  function updateHUD(){ scoreEl.textContent=score; streakEl.textContent=streak; missEl.textContent=misses; timeEl.textContent = gameActive? timeLeft : "‚Äî"; }

  function spawnOne(xvw = null){
    if (activeCount() >= CUR_MAX_ACTIVE) return;

    const { n, pad, step } = lanes();
    if (xvw === null){
      xvw = pad + (laneIndex * step) + (Math.random()*step*0.4 - step*0.2);
      laneIndex = (laneIndex + 1) % n;
    }

    const wrap = document.createElement('div');
    wrap.className = 'emoji';
    wrap.style.left = xvw + "vw";

    const span = document.createElement('span');
    span.className = 'inner';
    span.textContent = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];

    const dur   = CUR_DUR_RANGE[0] + Math.random() * (CUR_DUR_RANGE[1] - CUR_DUR_RANGE[0]);
    const delay = Math.random() * 0.6;
    const size  = 24 + Math.random() * 18;
    const sway  = (Math.random()<.5?-1:1) * (12 + Math.random()*22);
    const rot   = (Math.random()<.5?-1:1) * (5 + Math.random()*12) + "deg";

    wrap.style.animation = `fall ${dur}s linear ${delay}s forwards`;
    span.style.fontSize = size + "px";
    span.style.setProperty('--sx', sway + "px");
    span.style.setProperty('--rot', rot);

    let clicked=false;
    span.addEventListener('click', (e)=>{
      e.stopPropagation();
      clicked=true;
      const r = span.getBoundingClientRect();
      // scoring
      if (gameActive){
        const gain = 1 + Math.min(streak, 5); // small streak bonus up to +5
        score += gain; streak += 1; updateHUD();
      }
      wrap.classList.add('pop');
      span.style.animation = 'popAway .55s ease-out forwards';
      sparkle(r.left + r.width/2, r.top, "‚ú®");
      setTimeout(()=> wrap.remove(), 550);
    });

    wrap.appendChild(span);
    document.body.appendChild(wrap);

    // Miss tracking when it leaves bottom
    const ttl = (dur+delay+0.6)*1000;
    setTimeout(()=>{
      if (gameActive && !clicked){ streak=0; misses+=1; updateHUD(); }
      wrap.remove();
    }, ttl);
  }

  function setSpawner(ms){
    if (spawner){ clearInterval(spawner); spawner=null; }
    spawner = setInterval(()=>spawnOne(), ms);
  }

  // Start rain in normal mode
  window.addEventListener('load', ()=> setSpawner(CUR_SPAWN_MS));

  // Replay = small burst
  document.getElementById('replay').addEventListener('click', ()=>{
    for(let i=0;i<10;i++) setTimeout(()=>spawnOne(), i*100);
  });

  // ===== Game control =====
  function startGame(){
    if (gameActive) return;
    gameActive = true;
    score=0; streak=0; misses=0; timeLeft=GAME_TIME; updateHUD();

    CUR_MAX_ACTIVE = GAME_MAX_ACTIVE;
    CUR_SPAWN_MS   = GAME_SPAWN_MS;
    CUR_DUR_RANGE  = [...GAME_DUR_RANGE];
    setSpawner(CUR_SPAWN_MS);

    // difficulty ramp every 10s: slightly quicker
    diffTimer = setInterval(()=>{
      CUR_SPAWN_MS = Math.max(360, CUR_SPAWN_MS-60);
      CUR_DUR_RANGE = [Math.max(6, CUR_DUR_RANGE[0]-1), Math.max(10, CUR_DUR_RANGE[1]-1)];
      setSpawner(CUR_SPAWN_MS);
    }, 10000);

    // countdown
    gameTimer = setInterval(()=>{
      timeLeft--; updateHUD();
      if (timeLeft<=0) endGame();
    }, 1000);

    playBtn.disabled = true; playBtn.textContent = "‚è≥ Playing‚Ä¶";
  }

  function endGame(){
    gameActive = false;
    clearInterval(gameTimer); clearInterval(diffTimer);
    CUR_MAX_ACTIVE = 18; CUR_SPAWN_MS = 950; CUR_DUR_RANGE = [12,20];
    setSpawner(CUR_SPAWN_MS);

    // best score
    if (score > best){ best = score; localStorage.setItem('gb_best', String(best)); bestEl.textContent = best; }

    // toast
    const t = document.getElementById('toast');
    t.innerHTML = `Game over ‚Äî <b>${score}</b> pts ¬∑ Streak <b>${streak}</b> ¬∑ Misses <b>${misses}</b> ¬∑ Best <b>${best}</b>`;
    t.classList.add('show');
    setTimeout(()=> t.classList.remove('show'), 3000);

    playBtn.disabled = false; playBtn.textContent = "‚ñ∂Ô∏è Play 30s";
    timeEl.textContent = "‚Äî";
  }

  document.getElementById('playBtn').addEventListener('click', startGame);

  // Reduced motion
  if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches){
    clearInterval(spawner);
  }

  /* ====== Google Form direct submit (no email) ====== */
  const GF_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSepDMrPMO7QyUpuBlqOZFUDsvVUg6XtiYh0G2eYARxeD-3cMA/formResponse";
  const GF_FEEDBACK_FIELD = "entry.1175385091";

  const modal = document.getElementById('modal');
  const feedbackBtn = document.getElementById('feedbackBtn');
  const cancelBtn = document.getElementById('cancel');
  const sendBtn = document.getElementById('send');
  const fbText = document.getElementById('fbText');

  feedbackBtn.addEventListener('click', () => { modal.classList.add('open'); fbText.focus(); });
  cancelBtn.addEventListener('click', () => modal.classList.remove('open'));

  sendBtn.addEventListener('click', () => {
    const message = fbText.value.trim();
    if (!message){ alert("Please write a quick note first."); return; }

    const form = document.createElement('form');
    form.method = 'POST';
    form.action = GF_ACTION;
    form.target = 'gform-target';

    const msgInput = document.createElement('textarea');
    msgInput.name = GF_FEEDBACK_FIELD;
    msgInput.value = `${message}\n\n‚Äî sent from: ${location.href}`;
    form.appendChild(msgInput);

    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);

    alert("Thanks! Your feedback was sent ‚úÖ");
    modal.classList.remove('open');
    fbText.value = "";
  });
</script>
</body>
</html>

