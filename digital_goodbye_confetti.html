<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üéâ A Little Goodbye</title>
<style>
  :root{ --bg1:#0f172a; --bg2:#1e293b; --card:#0b1220cc; --text:#e2e8f0; --border:#1f2a44; --accent:#30c48d; }
  html,body{height:100%;margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
    color:var(--text); display:grid; place-items:center;
    background: radial-gradient(1200px 800px at 10% 10%, var(--bg2), var(--bg1));
    background-size:cover; background-position:center; background-attachment:fixed; overflow:hidden;
  }

  /* Card */
  .card{
    position:relative; z-index:3; width:min(92vw,720px);
    background:var(--card); border:1px solid var(--border); border-radius:20px; padding:28px 28px 22px;
    box-shadow:0 20px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05); backdrop-filter:blur(12px);
  }
  h1{ margin:8px 0 10px; font-size:clamp(28px,5vw,44px); line-height:1.1 }
  .msg{ margin:0 0 14px; font-size:clamp(16px,2.6vw,20px); opacity:.95 }
  .meta{ opacity:.8; font-size:14px; margin-top:6px }
  .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:18px }
  button{
    appearance:none; border:1px solid #334155; background:#0b1220; color:var(--text);
    padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
    transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease;
  }
  button:hover{ border-color:#475569; box-shadow:0 8px 20px rgba(0,0,0,.25); transform:translateY(-1px) }

  /* HUD */
  .hud{
    position:fixed; right:14px; top:14px; z-index:6; display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    background:#0b1220cc; border:1px solid var(--border); border-radius:12px; padding:8px 10px; font-size:12px; backdrop-filter:blur(8px)
  }
  .pill{ padding:4px 8px; border:1px solid #2b3b52; border-radius:10px; background:#0e1728 }
  .best{ border-color:#2e5a4c }
  .play{ border-color:#355281 }
  .mute{ border-color:#5a3a2e }

  /* Toast */
  .toast{
    position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
    background:#0b1220cc; border:1px solid var(--border); border-radius:12px; padding:10px 14px; font-weight:600;
    box-shadow:0 12px 30px rgba(0,0,0,.35); backdrop-filter:blur(8px); z-index:7; opacity:0; transition:.25s ease; pointer-events:none
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px) }

  /* Catcher (tray) */
  .catcher{
    position:fixed; bottom:24px; left:50%; transform:translateX(-50%); z-index:4;
    width:140px; height:24px; border-radius:12px; background:#0b1220aa; border:1px solid var(--border);
    box-shadow:0 10px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  }
  .catcher::after{ content:""; position:absolute; inset:2px; border-radius:10px; border:1px dashed #2f425e55 }

  /* Emojis */
  .emoji{ position:fixed; top:-60px; z-index:2; pointer-events:auto; user-select:none }
  .emoji .inner{
    display:block; filter:drop-shadow(0 3px 6px rgba(0,0,0,.35));
    animation:sway 7s ease-in-out infinite; transition:transform .12s ease, opacity .2s ease; cursor:pointer
  }
  .emoji .inner:hover{ transform:scale(1.12) }
  .emoji.pop .inner{ animation:none }
  @keyframes fall{ to{ transform:translateY(110vh); opacity:1 } }
  @keyframes sway{ 0%{ transform:translateX(0) rotate(0) } 50%{ transform:translateX(var(--sx,22px)) rotate(var(--rot,10deg)) } 100%{ transform:translateX(0) rotate(0) } }
  @keyframes popAway{ 0%{ transform:translateY(0) scale(1); opacity:1 } 60%{ transform:translateY(-18px) scale(1.35) } 100%{ transform:translateY(-46px) scale(.6); opacity:0 } }
  .sparkle{ position:fixed; z-index:5; color:#ffe08a; font-size:18px; filter:drop-shadow(0 2px 6px rgba(0,0,0,.35)); animation:sparkleUp .8s ease-out forwards }
  @keyframes sparkleUp{ 0%{ transform:translateY(0) scale(.9); opacity:.95 } 100%{ transform:translateY(-28px) scale(1.1); opacity:0 } }

  @media (prefers-reduced-motion: reduce){ .emoji .inner{ animation:none } }
</style>
</head>
<body>
  <!-- HUD -->
  <div class="hud">
    <span class="pill">Score: <b id="score">0</b></span>
    <span class="pill">Streak: <b id="streak">0</b></span>
    <span class="pill">Misses: <b id="misses">0</b></span>
    <span class="pill">Time: <b id="time">‚Äî</b></span>
    <span class="pill best">Best: <b id="best">0</b></span>
    <button class="pill play" id="playBtn">‚ñ∂Ô∏è Play 30s</button>
    <button class="pill mute" id="soundBtn">üîä Sound</button>
  </div>

  <div class="toast" id="toast"></div>
  <div class="catcher" id="catcher" aria-hidden="true"></div>

  <!-- Message Card -->
  <div class="card">
    <h1 id="title">Thank you, team!</h1>
    <p class="msg" id="message">It‚Äôs been a privilege to build, iterate, and ship with you. Wishing you smooth workflows and zero clashes ahead!</p>
    <p class="meta" id="signature">‚Äî Irfana</p>
    <div class="row">
      <button id="replay">ü§ù Replay animation</button>
      <button id="feedbackBtn">üí¨ Leave feedback</button>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div class="modal" id="modal" style="position:fixed;inset:0;display:none;z-index:10;align-items:center;justify-content:center;background:rgba(0,0,0,.45);padding:18px">
    <div class="modal-card" style="width:min(92vw,620px);background:#0b1220;border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 24px 60px rgba(0,0,0,.5)">
      <h2 style="margin:0 0 10px;font-size:20px">üí¨ Share your feedback</h2>
      <textarea id="fbText" placeholder="Write a quick note..." style="width:100%;min-height:140px;background:#0f172a;color:var(--text);border:1px solid #334155;border-radius:12px;padding:10px;font:inherit"></textarea>
      <div class="row" style="justify-content:flex-end;margin-top:12px">
        <button id="cancel">Cancel</button>
        <button id="send">Send</button>
      </div>
    </div>
  </div>

  <!-- Hidden iframe for Google Form -->
  <iframe name="gform-target" style="display:none"></iframe>

<script>
  /* ---------- Text & background ---------- */
  const qs = new URLSearchParams(location.search);
  const title = qs.get('title') || "Thank you, team!";
  const msg   = qs.get('msg')   || "It‚Äôs been a privilege to build, iterate, and ship with you. Wishing you smooth workflows and zero clashes ahead!";
  const name  = qs.get('name')  || "Irfana";
  const bg    = qs.get('bg')    || "1.jpeg";

  title && (document.getElementById('title').textContent = title);
  msg   && (document.getElementById('message').textContent = msg);
  name  && (document.getElementById('signature').textContent = `‚Äî ${name}`);
  if (bg){ const url = bg.match(/^https?:\/\//) ? bg : `${bg}`; document.body.style.backgroundImage = `url('${url}')`; }

  /* ---------- Audio (tiny) ---------- */
  let soundOn = false;
  const soundBtn = document.getElementById('soundBtn');
  soundBtn.onclick = () => { soundOn = !soundOn; soundBtn.textContent = soundOn ? "üîä Sound" : "üîá Sound"; };
  function beep(freq=880, ms=90){ if(!soundOn) return; try{
    const a = new (window.AudioContext||window.webkitAudioContext)();
    const o = a.createOscillator(); const g = a.createGain();
    o.type="triangle"; o.frequency.value=freq; o.connect(g); g.connect(a.destination); g.gain.setValueAtTime(0.08, a.currentTime);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, a.currentTime + ms/1000); o.stop(a.currentTime + ms/1000 + .02);
  }catch{} }

  /* ---------- HUD & helpers ---------- */
  const scoreEl = document.getElementById('score');
  const streakEl= document.getElementById('streak');
  const missEl  = document.getElementById('misses');
  const timeEl  = document.getElementById('time');
  const bestEl  = document.getElementById('best');
  const toast   = document.getElementById('toast');
  let best = Number(localStorage.getItem('gb_best')||0); bestEl.textContent = best;

  function showToast(html){ toast.innerHTML = html; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2500); }
  function vibrate(ms=20){ if(navigator.vibrate) navigator.vibrate(ms); }

  /* ---------- Game config ---------- */
  const EMOJIS = [
    {ch:"üëã", pts:1,   weight:48, color:"‚ú®"},
    {ch:"ü§ù", pts:2,   weight:34, color:"üí´", time:+1},
    {ch:"üíê", pts:5,   weight:14, color:"üåü", slow:3000},
    {ch:"üöß", pts:-2,  weight:4,  color:"‚ö†Ô∏è", hazard:true}
  ];
  function pickEmoji(){
    const sum = EMOJIS.reduce((s,e)=>s+e.weight,0);
    let r = Math.random()*sum;
    for(const e of EMOJIS){ if((r-=e.weight)<=0) return e; }
    return EMOJIS[0];
  }

  // Speeds
  const NORMAL = { MAX:18, SPAWN:800,  DUR:[10,16] }; // faster than before
  const GAME   = { MAX:26, SPAWN:460,  DUR:[7,12]  };

  let cur = {...NORMAL};

  /* ---------- Spawning & objects ---------- */
  let laneIndex = 0, spawner=null, slowUntil=0;
  function lanes(){ const n=Math.max(10, Math.floor(innerWidth/120)), pad=1.5, step=(100-pad*2)/(n-1); return {n,pad,step}; }
  function activeCount(){ return document.querySelectorAll('.emoji').length; }

  function sparkle(x,y,txt="‚ú®"){
    const s=document.createElement('div'); s.className='sparkle'; s.textContent=txt; s.style.left=x+"px"; s.style.top=y+"px";
    document.body.appendChild(s); setTimeout(()=>s.remove(),900);
  }

  function spawnOne(xvw=null){
    if (activeCount() >= cur.MAX) return;
    const {n,pad,step} = lanes();
    if (xvw===null){ xvw = pad + (laneIndex*step) + (Math.random()*step*0.4 - step*0.2); laneIndex=(laneIndex+1)%n; }

    const type = pickEmoji();
    const wrap=document.createElement('div'); wrap.className='emoji'; wrap.style.left = xvw+"vw";
    const inner=document.createElement('span'); inner.className='inner'; inner.textContent=type.ch; inner.dataset.type=type.ch;
    const dur = (Date.now()<slowUntil ? 1.25 : 1)* ( type.hazard ? (cur.DUR[0]+Math.random()*(cur.DUR[1]-cur.DUR[0]))*0.9
                                                                  :  cur.DUR[0]+Math.random()*(cur.DUR[1]-cur.DUR[0]) );
    const delay=Math.random()*0.4, size=24+Math.random()*18, sway=(Math.random()<.5?-1:1)*(12+Math.random()*22),
          rot=(Math.random()<.5?-1:1)*(5+Math.random()*12)+"deg";
    wrap.style.animation=`fall ${dur}s linear ${delay}s forwards`; inner.style.fontSize=size+"px";
    inner.style.setProperty('--sx',sway+"px"); inner.style.setProperty('--rot',rot);
    wrap.appendChild(inner); document.body.appendChild(wrap);

    // Clicking still gives points
    let clicked=false;
    inner.addEventListener('click', e=>{
      e.stopPropagation(); clicked=true; onCatch(type, inner);
      const r=inner.getBoundingClientRect(); wrap.classList.add('pop'); inner.style.animation='popAway .55s ease-out forwards';
      sparkle(r.left+r.width/2, r.top, type.color); setTimeout(()=>wrap.remove(),550);
    });

    // Miss if it reaches bottom
    setTimeout(()=>{ if(gameActive && !clicked){ streak=0; misses++; updateHUD(); }
                     wrap.remove(); }, (dur+delay+0.65)*1000);
  }

  function setSpawner(ms){ if(spawner) clearInterval(spawner); spawner=setInterval(()=>spawnOne(), ms); }

  /* ---------- Catcher (move + collisions) ---------- */
  const catcher = document.getElementById('catcher');
  function moveCatcher(x){ const w=140, nx=Math.min(Math.max(10, x - w/2), innerWidth - w - 10); catcher.style.left = nx+"px"; }
  window.addEventListener('mousemove', e=> moveCatcher(e.clientX));
  window.addEventListener('touchmove', e=> { if(e.touches[0]) moveCatcher(e.touches[0].clientX) }, {passive:true});
  moveCatcher(innerWidth/2);

  // collision check
  setInterval(()=>{
    if(!gameActive) return;
    const cR = catcher.getBoundingClientRect();
    document.querySelectorAll('.emoji').forEach(wrap=>{
      if(wrap.dataset.hit) return;
      const r = wrap.getBoundingClientRect();
      const overlap = !(r.right < cR.left || r.left > cR.right || r.bottom < cR.top || r.top > cR.bottom);
      if(overlap){
        wrap.dataset.hit="1";
        const inner = wrap.querySelector('.inner');
        const type = EMOJIS.find(e=>e.ch===inner.dataset.type) || EMOJIS[0];
        onCatch(type, inner);
        wrap.classList.add('pop'); inner.style.animation='popAway .45s ease-out forwards';
        sparkle(r.left + r.width/2, r.top, type.color);
        setTimeout(()=>wrap.remove(), 450);
      }
    });
  }, 45);

  /* ---------- Scoring ---------- */
  let gameActive=false, score=0, streak=0, misses=0, timeLeft=0, timer=null, ramp=null;

  function updateHUD(){ scoreEl.textContent=score; streakEl.textContent=streak; missEl.textContent=misses; timeEl.textContent=gameActive?timeLeft:"‚Äî"; }

  function applauseWave(){
    // friendly burst
    for(let i=0;i<14;i++) setTimeout(()=>spawnOne(), i*60);
    showToast("üëè Nice combo!");
    beep(1200,120);
  }

  function onCatch(type, inner){
    if (!gameActive) return;
    if (type.hazard){
      score = Math.max(0, score + type.pts); streak = 0; showToast("üöß Oops! ‚àí2 & streak reset"); beep(180,120); vibrate(20);
    }else{
      const bonus = 1 + Math.min(streak, 5);
      score += type.pts + (streak>=1 ? Math.floor(bonus/2) : 0);
      streak++; if(streak % 10 === 0) applauseWave();
      if (type.time) { timeLeft += type.time; }
      if (type.slow) { slowUntil = Date.now() + type.slow; showToast("üåü Slow-mo!"); }
      beep(880,70); vibrate(12);
    }
    updateHUD();
  }

  /* ---------- Game loop ---------- */
  const playBtn = document.getElementById('playBtn');
  document.getElementById('replay').addEventListener('click', ()=>{ for(let i=0;i<10;i++) setTimeout(spawnOne, i*90); });

  function startNormal(){ cur={...NORMAL}; setSpawner(cur.SPAWN); }
  function startGame(){
    if (gameActive) return;
    gameActive=true; score=0; streak=0; misses=0; timeLeft=30; updateHUD();
    cur={...GAME}; setSpawner(cur.SPAWN);
    playBtn.disabled=true; playBtn.textContent="‚è≥ Playing‚Ä¶";
    // ramp difficulty every 8s
    ramp=setInterval(()=>{ cur.SPAWN=Math.max(360,cur.SPAWN-40); cur.DUR=[Math.max(6,cur.DUR[0]-0.6), Math.max(9,cur.DUR[1]-0.6)]; setSpawner(cur.SPAWN); },8000);
    timer=setInterval(()=>{ timeLeft--; updateHUD(); if(timeLeft<=0) endGame(); },1000);
  }
  function endGame(){
    gameActive=false; clearInterval(timer); clearInterval(ramp); startNormal();
    if (score>best){ best=score; localStorage.setItem('gb_best', String(best)); bestEl.textContent=best; }
    showToast(`Game over ‚Äî <b>${score}</b> pts ¬∑ Streak <b>${streak}</b> ¬∑ Misses <b>${misses}</b> ¬∑ Best <b>${best}</b>`);
    playBtn.disabled=false; playBtn.textContent="‚ñ∂Ô∏è Play 30s"; timeEl.textContent="‚Äî";
  }
  playBtn.addEventListener('click', startGame);

  // start normal rain
  window.addEventListener('load', startNormal);

  /* ---------- Feedback ‚Üí Google Form (direct submit) ---------- */
  const GF_ACTION="https://docs.google.com/forms/d/e/1FAIpQLSepDMrPMO7QyUpuBlqOZFUDsvVUg6XtiYh0G2eYARxeD-3cMA/formResponse";
  const GF_FIELD ="entry.1175385091";
  const modal=document.getElementById('modal');
  document.getElementById('feedbackBtn').onclick=()=>{ modal.style.display='flex'; document.getElementById('fbText').focus(); };
  document.getElementById('cancel').onclick = ()=> modal.style.display='none';
  document.getElementById('send').onclick = ()=>{
    const v=document.getElementById('fbText').value.trim();
    if(!v){ alert("Please write a quick note first."); return; }
    const form=document.createElement('form'); form.method='POST'; form.action=GF_ACTION; form.target='gform-target';
    const t=document.createElement('textarea'); t.name=GF_FIELD; t.value=`${v}\n\n‚Äî sent from: ${location.href}`; form.appendChild(t);
    document.body.appendChild(form); form.submit(); document.body.removeChild(form);
    alert("Thanks! Your feedback was sent ‚úÖ"); modal.style.display='none'; document.getElementById('fbText').value="";
  };
</script>
</body>
</html>
